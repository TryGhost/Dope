<!DOCTYPE html>
<html lang="{{@site.locale}}"{{#match @custom.color_scheme "=" "Dark mode"}} data-theme="dark"{{/match}}{{#match @custom.color_scheme "=" "Light mode"}} data-theme="light"{{/match}}>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{meta_title}}</title>

    {{!-- Preload critical fonts --}}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet" href="{{asset "built/screen.css"}}">

    {{{block "styles"}}}

    {{!-- Theme color for mobile browsers --}}
    <meta name="theme-color" content="#0f0f0f" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">

    {{ghost_head}}
</head>

<body class="{{body_class}}{{#match @custom.title_font "=" "Elegant serif"}} has-serif-title{{/match}}{{#match @custom.title_font "=" "Newspaper classic"}} has-display-title{{/match}}{{#match @custom.body_font "=" "Elegant serif"}} has-serif-body{{/match}}">

{{!-- Skip to main content link for accessibility --}}
<a href="#main-content" class="skip-link">Skip to main content</a>

{{!-- Live region for screen reader announcements --}}
<div aria-live="polite" aria-atomic="true" class="sr-only" id="announcements"></div>

<div class="site">

    <header class="site-header gh-outer" role="banner">
        <div class="navbar">
            <a class="logo" href="{{@site.url}}" aria-label="{{@site.title}} home">
                {{#if @site.logo}}
                    <img class="logo-image" src="{{@site.logo}}" alt="{{@site.title}}">
                {{else}}
                    <span class="logo-text">{{@site.title}}</span>
                {{/if}}
            </a>

            {{!-- Whistleblower tip link in header --}}
            {{#if @custom.whistleblower_link}}
                <a href="{{@custom.whistleblower_link}}" class="header-tip-link" aria-label="Submit anonymous tip securely">
                    <span aria-hidden="true">üîí</span> Submit a Tip
                </a>
            {{/if}}

            {{!-- Theme toggle button --}}
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark/light mode" title="Toggle theme">
                <span class="theme-toggle-icon" aria-hidden="true">üåô</span>
            </button>

            <button class="burger" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="side-menu">
                <span class="burger-line"></span>
                <span class="burger-line"></span>
                <span class="burger-line"></span>
            </button>
        </div>
    </header>

    <main class="site-content" id="main-content" role="main">
        {{{body}}}
    </main>

    <footer class="gh-foot{{#unless @site.secondary_navigation}} no-menu{{/unless}} gh-outer" role="contentinfo">
        <div class="gh-foot-inner gh-inner">
            <div class="gh-copyright">
                {{@site.title}} ¬© {{date format="YYYY"}} | Independent Furry Journalism
            </div>
            {{#if @site.secondary_navigation}}
                <nav class="gh-foot-menu" aria-label="Footer navigation">
                    {{navigation type="secondary"}}
                </nav>
            {{/if}}

            {{!-- Whistleblower/Ethics links in footer --}}
            <div class="gh-foot-journalism">
                {{#if @custom.whistleblower_link}}
                    <a href="{{@custom.whistleblower_link}}" class="foot-tip-link">
                        <span aria-hidden="true">üîí</span> Submit Anonymous Tip
                    </a>
                {{/if}}
                <a href="/ethics">Editorial Ethics</a>
                <a href="/corrections">Corrections Policy</a>
            </div>

            <div class="gh-powered-by">
                <a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a>
            </div>
        </div>
    </footer>

</div>

{{> "side-menu"}}

{{#is "post, page"}}
    {{> "pswp"}}
{{/is}}

<script>
    // Tag feed height adjustment
    if (document.getElementsByClassName('tag-feed').length) {
        document.getElementsByClassName('tag-feed')[0].style.height = window.innerHeight + 'px';
    }

    // Theme toggle functionality
    (function() {
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const icon = themeToggle?.querySelector('.theme-toggle-icon');

        // Check for saved theme preference or default to dark
        const currentTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', currentTheme);
        if (icon) icon.textContent = currentTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';

        themeToggle?.addEventListener('click', function() {
            const theme = html.getAttribute('data-theme');
            const newTheme = theme === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            if (icon) icon.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';

            // Announce theme change to screen readers
            const announcement = document.getElementById('announcements');
            if (announcement) {
                announcement.textContent = `Theme changed to ${newTheme} mode`;
            }
        });

        // Keyboard navigation helper
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                document.body.classList.add('keyboard-nav-active');
            }
        });

        document.addEventListener('mousedown', function() {
            document.body.classList.remove('keyboard-nav-active');
        });
    })();
</script>

<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="{{asset "built/main.min.js"}}"></script>
<script src="{{asset "js/search.js"}}"></script>

{{ghost_foot}}

</body>
</html>